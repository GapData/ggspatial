<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ggspatial by paleolimbot</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>ggspatial</h1>
        <p>A spatial data framework for ggplot2</p>

        <p class="view"><a href="https://github.com/paleolimbot/ggspatial">View the Project on GitHub <small>paleolimbot/ggspatial</small></a></p>


        <ul>
          <li><a href="https://github.com/paleolimbot/ggspatial/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/paleolimbot/ggspatial/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/paleolimbot/ggspatial">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="ggspatial-spatial-data-framework-for-ggplot2" class="anchor" href="#ggspatial-spatial-data-framework-for-ggplot2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ggspatial: Spatial data framework for ggplot2</h1>

<p>Spatial data plus the power of the <code>ggplot2</code> framework means easier mapping for all! Unfortunately facetting with <code>scales="free"</code> doesn't work properly with <code>coord_fixed()</code>, so facetting is out if you want different extents in each facet window. But easy use of <code>ggplot2</code> with <code>sp</code>, <code>raster</code>, and basemaps through the <code>rosm</code> package is a go!</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>There are no plans to release <code>ggspatial</code> to CRAN until the facetting/<code>coord_fixed</code> bug is fixed in ggplot, but you can install using <code>devtools::install_github()</code>.</p>

<div class="highlight highlight-source-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">"</span>devtools<span class="pl-pds">"</span></span>) <span class="pl-c"># if devtools isn't installed</span>
<span class="pl-e">devtools</span><span class="pl-k">::</span>install_github(<span class="pl-s"><span class="pl-pds">"</span>paleolimbot/ggspatial<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="spatial-objects" class="anchor" href="#spatial-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spatial objects</h2>

<p>Many (but not all) objects of type <code>Spatial*</code> can be used with <code>ggplot</code>, but syntax is inconsistent and results vary. This package introduces a single <code>geom_</code> for use with <code>Spatial*</code> objects (e.g. <code>SpatialPointsDataFrame</code>, <code>SpatialLinesDataFrame</code>, <code>SpatialPolygonsDataFrame</code>...essentially what you get when you use <code>rgdal::readOGR()</code> to read any kind of spatial data). A few datasets are included in the package as examples.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">ggspatial</span>)
data(<span class="pl-smi">longlake_waterdf</span>)
ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">longlake_waterdf</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-2-1.png" alt=""></p>

<p>If we examine <code>longlake_waterdf</code>, we can use the columns as aesthetics just as we would for a normal <code>data.frame</code>.</p>

<div class="highlight highlight-source-r"><pre>names(<span class="pl-smi">longlake_waterdf</span>)</pre></div>

<pre><code>##  [1] "OBJECTID_1" "OBJECTID"   "FEAT_CODE"  "HID"        "PROVKEY"   
##  [6] "ZVALUE"     "STARTDATE"  "ENDDATE"    "PRODUCT"    "SCALE"     
## [11] "COLLECTOR"  "CAPTURE"    "PRODYEAR"   "PRODMONTH"  "X_Y_ACC"   
## [16] "Z_ACC"      "MINZ"       "MAXZ"       "POLY_CLASS" "SHAPE_LENG"
## [21] "SHAPE_LE_1" "label"      "area"
</code></pre>

<div class="highlight highlight-source-r"><pre>ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">longlake_waterdf</span>, aes(<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">label</span>)) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-3-1.png" alt=""></p>

<div class="highlight highlight-source-r"><pre>ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">longlake_waterdf</span>, aes(<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">label</span>, <span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">area</span>)) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-3-2.png" alt=""></p>

<p>A more useful use of this may be to examine a depth survey from Long Lake I took on for my honours thesis.</p>

<div class="highlight highlight-source-r"><pre>data(<span class="pl-smi">longlake_depthdf</span>)
ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">longlake_waterdf</span>[<span class="pl-c1">2</span>,], <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>lightblue<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  geom_spatial(<span class="pl-smi">longlake_depthdf</span>, aes(<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">DEPTH.M</span>), <span class="pl-v">size</span><span class="pl-k">=</span><span class="pl-c1">2</span>) <span class="pl-k">+</span> 
  scale_color_gradient(<span class="pl-v">high</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, <span class="pl-v">low</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>#56B1F7<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-4-1.png" alt=""></p>

<p>You'll notice some bits are still a work in progress, mostly that polygons with internal rings are not rendered properly. This is on the to do list!.</p>

<h2>
<a id="projections" class="anchor" href="#projections" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Projections</h2>

<p>In our previous example the data were all in UTM zone 20 (epsg 26920), so we didn't have to worry about the data looking distorted because it's in lat/lon. For this example we're going to use the <code>wrld_simpl</code> dataset in the <code>maptools</code> package.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">maptools</span>)
data(<span class="pl-smi">wrld_simpl</span>)
<span class="pl-smi">no_antarctica</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">wrld_simpl</span>[<span class="pl-smi">wrld_simpl</span><span class="pl-k">$</span><span class="pl-smi">REGION</span> <span class="pl-k">!=</span> <span class="pl-c1">0</span>,] <span class="pl-c"># antarctica complicates this example so...</span>
ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">no_antarctica</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-5-1.png" alt=""></p>

<p>See? It's squished. Canada in particular looks all wrong, because our plot units are lat/lon which aren't distances. The number one way to look bad at a conference is to display an improperly projected map (depending who's looking...). We can fix this by passing a <code>toepsg</code> parameter (you can also pass a <code>CRS</code> object but that's more complicated).</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># epsg:3857 is the google maps projection (spherical mercator)</span>
ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">no_antarctica</span>, <span class="pl-v">toepsg</span><span class="pl-k">=</span><span class="pl-c1">3857</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-6-1.png" alt=""></p>

<p>You can also project a regular old <code>data.frame</code> by using <code>geom_spatial()</code>. You have to specify for each one that you want it projected to epsg 3857 or it won't know.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">prettymapr</span>)
<span class="pl-smi">cities</span> <span class="pl-k">&lt;-</span> geocode(c(<span class="pl-s"><span class="pl-pds">"</span>Halifax, NS<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Los Angeles, CA<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Auckland, NZ<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Moscow, RU<span class="pl-pds">"</span></span>))
ggplot() <span class="pl-k">+</span> geom_spatial(<span class="pl-smi">no_antarctica</span>, <span class="pl-v">toepsg</span><span class="pl-k">=</span><span class="pl-c1">3857</span>) <span class="pl-k">+</span> 
  geom_spatial(<span class="pl-smi">cities</span>, aes(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-smi">lon</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">lat</span>, <span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">query</span>), <span class="pl-v">toepsg</span><span class="pl-k">=</span><span class="pl-c1">3857</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-7-1.png" alt=""></p>

<p>Unfortunately I haven't gotten around to the labeling bit, but it isn't too much of a stretch to make happen should somebody need it in the future.</p>

<h2>
<a id="osm-basemaps" class="anchor" href="#osm-basemaps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OSM Basemaps</h2>

<p>Thanks to the brilliant creator of the <code>rosm</code> package, we can make a wrapper around the <code>osm.raster</code> function that lets us display a basemap behind whatever is on the screen. Note that this won't work if you mess with the projections too much, but if your data is in lat/lon and you're looking for a backdrop OR you just want an OSM map in a given projection, you can make it happen.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">ns</span> <span class="pl-k">&lt;-</span> searchbbox(<span class="pl-s"><span class="pl-pds">"</span>Nova Scotia<span class="pl-pds">"</span></span>)
ggplot() <span class="pl-k">+</span> geom_osm(<span class="pl-smi">ns</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-8-1.png" alt=""></p>

<p>Note that it's not very pretty (you'll get much better results with <code>osm.plot()</code>), but it's at the very least a native solution to the raster problem. It's also no problem to project to any projection (provided all your original data is in lat/lon, which is the most common anyway)</p>

<div class="highlight highlight-source-r"><pre>ggplot() <span class="pl-k">+</span> geom_osm(<span class="pl-smi">ns</span>, <span class="pl-v">epsg</span><span class="pl-k">=</span><span class="pl-c1">26920</span>) <span class="pl-k">+</span> coord_fixed() <span class="pl-c"># plot in UTM</span></pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-9-1.png" alt=""></p>

<p>You can also use <code>geom_osm()</code> with no arguments to provide a backdrop for your other data (again, can't stress enough that your un <code>geom_spatial</code>ed data should be in lat/lons if you're going to do this).</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">cities</span> <span class="pl-k">&lt;-</span> geocode(c(<span class="pl-s"><span class="pl-pds">"</span>Wolfville, NS<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Windsor, NS<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Halifax, NS<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Lunenburg, NS<span class="pl-pds">"</span></span>))
ggplot(<span class="pl-smi">cities</span>, aes(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-smi">lon</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">lat</span>, <span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">query</span>)) <span class="pl-k">+</span> 
  geom_osm() <span class="pl-k">+</span> geom_spatial() <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-10-1.png" alt=""></p>

<p>The way ggplot works is pretty automatic, so there's not a whole lot I think that is possible on the zooming out front. If you're really worried about your OSM background, you should just use <code>osm.raster()</code> to get yourself a <code>RasterBrick</code> object (or write it to a file) and then use a <code>geom_spraster()</code> to plot it. Which brings me to...</p>

<h2>
<a id="raster-objects" class="anchor" href="#raster-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Raster objects</h2>

<p>The other game in town for spatial data in R is the <code>raster</code> package. You can read in raster datasets using the <code>raster::brick()</code> function with the filename as the argument.</p>

<div class="highlight highlight-source-r"><pre>data(<span class="pl-smi">longlake_osm</span>)
ggplot() <span class="pl-k">+</span> geom_spraster(<span class="pl-smi">longlake_osm</span>) <span class="pl-k">+</span> coord_fixed()</pre></div>

<p><img src="README_files/figure-markdown_github/unnamed-chunk-11-1.png" alt=""></p>

<p>There's probably some nuances with raster datasets that I haven't thought about, but you can display specific bands and change the aesthetic (default is "fill", but "alpha" might also be appropriate). RGB datasets should work automatically (plus you can change which band is which using the <code>rgb</code> argument) but RGB with alpha probably won't work without some modification of the code.</p>

<h2>
<a id="bugs" class="anchor" href="#bugs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bugs</h2>

<p>The main bugs that need to be addressed in this package are:</p>

<ul>
<li>  Polygons with inner rings do not display (need to lookup if this is possible in ggplot at all)</li>
<li>  Raster RGBA support (important for hillshading)</li>
<li>  Facetting with <code>coord_fixed()</code> and <code>scales="free"</code> would be a major asset, althoug this bug needs to be fixed in <code>ggplot</code> and not this package.</li>
</ul>

<p>That's it! Enjoy!</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/paleolimbot">paleolimbot</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
